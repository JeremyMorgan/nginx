##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# https://www.nginx.com/resources/wiki/start/
# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
# https://wiki.debian.org/Nginx/DirectoryStructure
#
# In most cases, administrators will remove this file from sites-enabled/ and
# leave it as reference inside of sites-available where it will continue to be
# updated by the nginx packaging team.
#
# This file will automatically load configuration files provided by other
# applications, such as Drupal or Wordpress. These applications will be made
# available underneath a path with that package name, such as /drupal8.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##
# From To configure an HTTPS server, the ssl parameter must be enabled on listening sockets in the server block, and the locations of the server certificate and private key files should be specified:

server {
    server_name jeffsilverm.ddns.net ; # managed by Certbot
# Can the listen directives go in the common.conf file?
    listen 443 ssl ;
    listen [::]:443 ssl  ipv6only=on;
    ssl_certificate /etc/letsencrypt/live/jeffsilverm.ddns.net-0002/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/jeffsilverm.ddns.net-0002/privkey.pem; # managed by Certbot
# For reasons I do not understand, I can't put the location directive in an included file  :-(
    location / {
	# First attempt to serve request as file, then
	# as directory, then fall back to displaying a 404.
	# https://nginx.org/en/docs/http/ngx_http_core_module.html#try_files
	# try_files $uri $uri/ =404;
        # https://nginx.org/en/docs/http/ngx_http_index_module.html#index
        # index  index.html index.htm;	# delegated to the common.conf file

    # If there is a directory which does not have an index file, then
    # generate an index automatically (alternativce is a 404 error)
        autoindex on;
	root /var/www/html/;
    }
    include sites-enabled/common.conf;
}

server {
    server_name jeffsilverman.ddns.net; 
    listen 443  ssl ;
    listen [::]:443  ssl ;
    ssl_certificate /etc/letsencrypt/live/jeffsilverman.ddns.net-0001/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/jeffsilverman.ddns.net-0001/privkey.pem; # managed by Certbot
    location / {
        autoindex on;
	root /var/www/html/;
    }
    include sites-enabled/common.conf;
}

server {
    server_name jeffsilverman-aaaa.ddns.net ;
    listen 443 ssl  ;
    listen [::]:443  ssl ;
    ssl_certificate /etc/letsencrypt/live/jeffsilverman-aaaa.ddns.net-0002/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/jeffsilverman-aaaa.ddns.net-0002/privkey.pem; # managed by Certbot
    location / {
        autoindex on;
	root /var/www/html/;
    }
    include sites-enabled/common.conf;
}


server {
    listen 80 ;
    listen [::]:80 ;
    server_name jeffsilverm.ddns.net jeffsilverman.ddns.net jeffsilverman-aaaa.ddns.net;
    return 301 https://$host$request_uri  ; # managed by Certbot
}


# Default server configuration
#
server {
	server_name _;			# wildcard name
	listen 80 default_server;
	listen [::]:80 default_server;

	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	# Use certs from lets encrypt (use certbot) instead
	# Look at logbook notes_2023-11.html#mozTocId731748 for procedure.

	root /var/www/html;

	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;


	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ =404;
	}
}
